<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shop - Guardian Angel Studio</title>
    <link rel="stylesheet" href="static/css/shop.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>
<body>
    <!-- Floating particles background -->
    <div class="particles">
        <div class="particle" style="left: 10%; animation-delay: 0s;"></div>
        <div class="particle" style="left: 20%; animation-delay: 1s;"></div>
        <div class="particle" style="left: 30%; animation-delay: 2s;"></div>
        <div class="particle" style="left: 40%; animation-delay: 3s;"></div>
        <div class="particle" style="left: 50%; animation-delay: 4s;"></div>
        <div class="particle" style="left: 60%; animation-delay: 5s;"></div>
        <div class="particle" style="left: 70%; animation-delay: 6s;"></div>
        <div class="particle" style="left: 80%; animation-delay: 7s;"></div>
        <div class="particle" style="left: 90%; animation-delay: 0.5s;"></div>
    </div>
    
    <nav>
        <div class="company-name">
            <h1>GUARDIAN <span class="highlight">ANGEL</span> STUDIO<span class="dot"></span></h1>
        </div>
        <ul>
            <li><a href="index.html">home</a></li>
            <li><a href="about.html">about</a></li>
            <li><a href="service.html">service</a></li>
            <li><a href="contacts.html">contact</a></li>
            <li><a href="shop.html">shop</a></li>
            <li><a href="search.html"><i class="fas fa-search"></i></a></li>
            <li><a href="#" class="cart-button"><i class="fas fa-shopping-cart"></i><span class="cart-count" style="display: none;">0</span></a></li>
        </ul>
    </nav>


    <section class="shop-section">
        <h1>Shop Our Products</h1>

        <!-- Loading indicator -->
        <div class="loading" style="text-align: center; padding: 2rem; display: none;">
            <i class="fas fa-spinner fa-spin" style="font-size: 2rem; color: #0eada8;"></i>
            <p>Loading products...</p>
        </div>

        <!-- Error message -->
        <div class="error-message" style="display: none; text-align: center; padding: 2rem; color: #ff4444;">
            <i class="fas fa-exclamation-triangle" style="font-size: 2rem;"></i>
            <p>Error loading products. Please refresh the page.</p>
        </div>

        <!-- Product list will be populated by JavaScript -->
        <div class="product-list" id="productList">
            <!-- Fallback static products in case API fails -->
            <div class="product-item" data-product-id="1">
                <h2>Design</h2>
                <p class="product-description">Professional design services for your business</p>
                <p class="product-price">R2000.00</p>
                <button class="add-to-cart">Add to Cart</button>
            </div>
            <div class="product-item" data-product-id="2">
                <h2>Professional Sound Hire</h2>
                <p class="product-description">High-quality audio equipment rental</p>
                <p class="product-price">R2000.00</p>
                <button class="add-to-cart">Add to Cart</button>
            </div>
            <div class="product-item" data-product-id="3">
                <h2>AI & Machine Learning</h2>
                <p class="product-description">Custom AI solutions and consulting</p>
                <p class="product-price">R2500.00</p>
                <button class="add-to-cart">Add to Cart</button>
            </div>
            <div class="product-item" data-product-id="4">
                <h2>Cyber Security</h2>
                <p class="product-description">Comprehensive security assessment and protection</p>
                <p class="product-price">R7000.00</p>
                <button class="add-to-cart">Add to Cart</button>
            </div>
            <div class="product-item" data-product-id="5">
                <h2>Photography</h2>
                <p class="product-description">Professional photography services</p>
                <p class="product-price">R2000.00</p>
                <button class="add-to-cart">Add to Cart</button>
            </div>
            <div class="product-item" data-product-id="6">
                <h2>Placement & Project Management</h2>
                <p class="product-description">Expert project management services</p>
                <p class="product-price">R2500.00</p>
                <button class="add-to-cart">Add to Cart</button>
            </div>
            <div class="product-item" data-product-id="7">
                <h2>Technical Support Services</h2>
                <p class="product-description">24/7 technical support and maintenance</p>
                <p class="product-price">R1500.00</p>
                <button class="add-to-cart">Add to Cart</button>
            </div>
            <div class="product-item" data-product-id="8">
                <h2>Videography</h2>
                <p class="product-description">Professional video production services</p>
                <p class="product-price">R2000.00</p>
                <button class="add-to-cart">Add to Cart</button>
            </div>
            <div class="product-item" data-product-id="9">
                <h2>Domain & Hosting</h2>
                <p class="product-description">Web hosting and domain registration</p>
                <p class="product-price">R3000.00</p>
                <button class="add-to-cart">Add to Cart</button>
            </div>
            <div class="product-item" data-product-id="10">
                <h2>Marketing</h2>
                <p class="product-description">Digital marketing and brand promotion</p>
                <p class="product-price">R1000.00</p>
                <button class="add-to-cart">Add to Cart</button>
            </div>
            <div class="product-item" data-product-id="11">
                <h2>Development</h2>
                <p class="product-description">Custom software development solutions</p>
                <p class="product-price">R5000.00</p>
                <button class="add-to-cart">Add to Cart</button>
            </div>
            <div class="product-item" data-product-id="12">
                <h2>Email Services</h2>
                <p class="product-description">Professional email hosting and management</p>
                <p class="product-price">R500.00</p>
                <button class="add-to-cart">Add to Cart</button>
            </div>
        </div>

        <!-- Cart Modal -->
        <div class="cart-modal" style="display: none;">
            <div class="cart-content">
                <span class="close-cart">&times;</span>
                <h2>Your Shopping Cart</h2>
                <div class="cart-items"></div>
                <div class="cart-total"></div>
                
                <!-- Enhanced Checkout Form -->
                <div class="checkout-form" style="display: none;">
                    <h3>Checkout</h3>
                    <form id="payment-form">
                        <div class="form-group">
                            <label for="customer-name">Full Name:</label>
                            <input type="text" id="customer-name" required placeholder="Your Name">
                        </div>
                        <div class="form-group">
                            <label for="customer-email">Email Address:</label>
                            <input type="email" id="customer-email" required placeholder="your@email.com">
                        </div>
                        <div class="form-group">
                            <label>Card Details:</label>
                            <div id="card-element" class="card-input"></div>
                            <div id="card-errors" role="alert" class="card-errors"></div>
                        </div>
                        <button type="submit" class="checkout-button-stripe">
                            <i class="fas fa-lock"></i> Complete Payment
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </section>

    <script src="/static/js/shop.js"></script>
    <script src="https://js.stripe.com/v3/"></script>
    <script>
        document.addEventListener('DOMContentLoaded', async () => {
            // Replace with your actual Stripe publishable key
            const STRIPE_PUBLIC_KEY = ''; // Add your Stripe key here
            
            try {
                window.shopManager = new AdvancedShopManager(STRIPE_PUBLIC_KEY);
                console.log('Shop manager initialized successfully');
                
                // Load products from API
                await loadProducts();
            } catch (error) {
                console.error('Failed to initialize shop manager:', error);
                // Fallback to basic shop manager
                window.shopManager = new ShopManager(STRIPE_PUBLIC_KEY);
            }
        });

        async function loadProducts() {
            const productList = document.getElementById('productList');
            const loading = document.querySelector('.loading');
            const errorMessage = document.querySelector('.error-message');
            
            try {
                // Show loading indicator
                if (loading) loading.style.display = 'block';
                if (errorMessage) errorMessage.style.display = 'none';

                const response = await fetch('/api/products');
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const products = await response.json();
                
                if (products && products.length > 0) {
                    // Clear existing products and populate with API data
                    productList.innerHTML = products.map(product => `
                        <div class="product-item" data-product-id="${product.id}">
                            <div class="product-icon"><i class="fas fa-${getProductIcon(product.name)}"></i></div>
                            <h2>${escapeHtml(product.name)}</h2>
                            <p class="product-description">${escapeHtml(product.description || '')}</p>
                            <p class="product-price">R${parseFloat(product.price).toFixed(2)}</p>
                            <button class="add-to-cart">Add to Cart</button>
                        </div>
                    `).join('');
                    
                    // Re-setup product buttons for the new elements
                    if (window.shopManager) {
                        window.shopManager.setupProductButtons();
                    }
                }
            } catch (error) {
                console.error('Error loading products:', error);
                
                // Show error message
                if (errorMessage) {
                    errorMessage.style.display = 'block';
                    errorMessage.querySelector('p').textContent = `Error loading products: ${error.message}`;
                }
            } finally {
                // Hide loading indicator
                if (loading) loading.style.display = 'none';
            }
        }

        async function verifyDatabaseSchema() {
            try {
            const { rows } = await pool.query(`
                SELECT column_name 
                FROM information_schema.columns 
                WHERE table_name = 'payments'
            `);
            const columns = rows.map(r => r.column_name);
    
            if (!columns.includes('customer_email')) {
            console.log('Adding missing customer_email column...');
            await pool.query('ALTER TABLE payments ADD COLUMN customer_email VARCHAR(255)');
            }
        } catch (err) {
            console.error('Schema verification failed:', err);
        }
    }
    

    // Call this during startup
    verifyDatabaseSchema();

        function getProductIcon(productName) {
            const icons = {
                'Design': 'paint-brush',
                'Professional Sound Hire': 'music',
                'AI & Machine Learning': 'robot',
                'Cyber Security': 'shield-alt',
                'Photography': 'camera',
                'Placement & Project Management': 'tasks',
                'Technical Support Services': 'headset',
                'Videography': 'video',
                'Domain & Hosting': 'globe',
                'Marketing': 'bullhorn',
                'Development': 'code',
                'Email Services': 'envelope'
            };
            
            return icons[productName] || 'shopping-cart';
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
    </script>
</body>
<footer>
        <div class="footer-container">
            <div class="footer-logo">
                <img src="static/css/PHOTO-2025-07-28-13-29-45.jpg" alt="Guardian Angel Studio Logo">
            </div>

            <div class="footer-info">
                <h4>Let's Talk About</h4>
                <p>We specialize in developing innovative technological solutions for businesses of all sizes, and our team of experienced professionals is committed to providing you with the best possible service and products.</p>
            </div>

            <div class="footer-about">
                <h4>About Us</h4>
                <ul>
                    <li>About</li>
                    <li>Projects</li>
                    <li>Process</li>
                    <li>Clients</li>
                    <li>Our Leadership Team</li>
                    <li>Careers</li>
                </ul>
            </div>

            <div class="footer-services">
                <h4>Services</h4>
                <ul>
                    <li>Design</li>
                    <li>Professional Sound Hire</li>
                    <li>Cyber Security</li>
                    <li>Domain & Hosting</li>
                    <li>Development</li>
                    <li>Marketing</li>
                    <li>Email</li>
                    <li>Photography</li>
                    <li>AI & Machine Learning</li>
                    <li>Placement & Project Management</li>
                    <li>Technical Support Services</li>
                    <li>Videography</li>
                </ul>
            </div>

            <div class="social-icons">
                <h4>Connect</h4>
                <div class="social-links">
                    <a href="https://www.facebook.com/profile.php?id=100066575685510" class="facebook" aria-label="Facebook">
                        <i class="fab fa-facebook-f"></i>
                    </a>
                    <a href="http://www.linkedin.com/in/guardian-angel-studios-158b7025a" class="linkedin" aria-label="LinkedIn">
                        <i class="fab fa-linkedin-in"></i>
                    </a>
                    <a href="https://www.instagram.com/gaurdianangelstudios/" class="instagram" aria-label="Instagram">
                        <i class="fab fa-instagram"></i>
                    </a>
                    <a href="https://wa.me/message/GND3LQDQJL22I1" class="whatsapp" aria-label="WhatsApp">
                        <i class="fab fa-whatsapp"></i>
                    </a>
                    <a href="mailto:info@guardian-angelstudios.co.za" class="email" aria-label="Email">
                        <i class="fas fa-envelope"></i>
                    </a>
                </div>
            </div>
        </div>
    </footer>
</html>